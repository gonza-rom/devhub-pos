---
import { Icon } from 'astro-icon/components';

const steps = [
  {
    num: '01',
    icon: 'lucide:user-plus',
    title: 'Creá tu cuenta',
    desc: 'Registrate con tu email en menos de 60 segundos. Sin formularios largos, sin burocracia. Tu prueba de 7 días empieza ahora mismo.',
    detail: 'Gratis · Sin tarjeta de crédito',
  },
  {
    num: '02',
    icon: 'lucide:store',
    title: 'Configurá tu comercio',
    desc: 'Cargá tu información, logo y categorías. Importá tus productos desde Excel o cargalos uno a uno. Nuestro asistente te guía en cada paso.',
    detail: 'Setup en menos de 10 minutos',
  },
  {
    num: '03',
    icon: 'lucide:scan-barcode',
    title: 'Activá el Modo Caja',
    desc: 'Abrí el modo de ventas desde cualquier dispositivo. Escaneá códigos de barra, aplicá descuentos y cobrá con múltiples medios de pago.',
    detail: 'Táctil y optimizado para velocidad',
  },
  {
    num: '04',
    icon: 'lucide:bar-chart-2',
    title: 'Medí y crecé',
    desc: 'Al final del día, revisá reportes automáticos con tus ventas, márgenes y productos estrella. Tomá decisiones basadas en datos reales.',
    detail: 'Reportes diarios automáticos',
  },
];
---

<section id="how-it-works" class="relative z-10 py-28 px-[5vw] overflow-hidden">

  <!-- Background decoration -->
  <div class="absolute right-0 top-1/2 -translate-y-1/2 w-[500px] h-[500px] pointer-events-none opacity-40"
       style="background: radial-gradient(ellipse, rgba(220,38,38,0.07) 0%, transparent 70%)" />

  <div class="max-w-[1200px] mx-auto">

    <div class="hiw-header mb-20">
      <span class="block text-[0.7rem] font-semibold tracking-[0.12em] uppercase text-red mb-4">
        Cómo funciona
      </span>
      <h2 class="font-head font-extrabold tracking-tight leading-[1.1] text-[clamp(2rem,3.5vw,3rem)] max-w-[16ch]">
        De cero a vendiendo<br />
        <em class="not-italic text-red">en 10 minutos.</em>
      </h2>
    </div>

    <!-- Steps -->
    <div class="relative">
      <!-- Vertical connector line (desktop) -->
      <div class="hidden md:block absolute left-[calc(50%-1px)] top-0 bottom-0 w-px bg-gradient-to-b from-transparent via-white/[0.07] to-transparent" />

      <div class="flex flex-col gap-12">
        {steps.map((step, i) => (
          <div
            class={`hiw-step relative flex flex-col md:flex-row gap-8 items-start md:items-center
                    ${i % 2 === 1 ? 'md:flex-row-reverse' : ''}`}
            style={`--delay: ${i * 120}ms`}
          >
            <!-- Content side -->
            <div class={`flex-1 ${i % 2 === 1 ? 'md:text-right' : ''}`}>
              <div class={`hiw-card bg-card border border-white/[0.07] rounded-xl p-8
                           hover:border-red/20 hover:bg-[#1a1a1a] transition-all duration-300 group`}>
                <div class={`flex items-center gap-3 mb-4 ${i % 2 === 1 ? 'md:justify-end' : ''}`}>
                  <div class="w-9 h-9 rounded-lg flex items-center justify-center
                              border border-red/25 group-hover:border-red/50 transition-colors duration-300"
                       style="background: rgba(220,38,38,0.1)">
                    <Icon name={step.icon} class="w-4 h-4 text-red" />
                  </div>
                  <span class="text-[0.65rem] font-bold tracking-[0.15em] uppercase text-gray-600">{step.detail}</span>
                </div>
                <h3 class="font-head font-bold text-xl mb-3 group-hover:text-red transition-colors duration-300">{step.title}</h3>
                <p class="text-gray-500 text-sm leading-relaxed">{step.desc}</p>
              </div>
            </div>

            <!-- Step number (center on desktop) -->
            <div class="hidden md:flex relative z-10 shrink-0 w-14 h-14 rounded-full
                        items-center justify-center border-2 border-red/30 bg-[#0F0F0F]
                        font-head font-extrabold text-sm text-red
                        group-hover:border-red transition-all duration-300 shadow-[0_0_0_6px_#0F0F0F]">
              {step.num}
            </div>

            <!-- Empty spacer for alternating layout -->
            <div class="flex-1 hidden md:block" />
          </div>
        ))}
      </div>
    </div>

    <!-- Bottom CTA -->
    <div class="hiw-cta mt-20 text-center">
      <a href="https://app.devhubpos.com/register"
         target="_blank" rel="noopener noreferrer"
         class="inline-flex items-center gap-2 px-8 py-4 rounded-md font-medium
                bg-red hover:bg-red-dk text-white
                transition-all duration-200 hover:-translate-y-px hover:shadow-glow no-underline text-sm">
        <Icon name="lucide:user-plus" class="w-4 h-4" /> Empezar ahora — es gratis
      </a>
    </div>

  </div>
</section>

<style>
  .hiw-header {
    opacity: 0; transform: translateY(24px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }
  .hiw-header.visible { opacity: 1; transform: translateY(0); }

  .hiw-step {
    opacity: 0; transform: translateY(32px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    transition-delay: var(--delay);
  }
  .hiw-step.visible { opacity: 1; transform: translateY(0); }

  .hiw-cta {
    opacity: 0; transform: translateY(20px);
    transition: opacity 0.6s 0.4s ease, transform 0.6s 0.4s ease;
  }
  .hiw-cta.visible { opacity: 1; transform: translateY(0); }
</style>

<script>
  const io = new IntersectionObserver(
    (entries) => entries.forEach((e) => e.isIntersecting && e.target.classList.add('visible')),
    { threshold: 0.1 }
  );
  document.querySelectorAll('.hiw-header, .hiw-step, .hiw-cta').forEach((el) => io.observe(el));
</script>